var FASER=function(e){var n={};function t(l){if(n[l])return n[l].exports;var o=n[l]={i:l,l:!1,exports:{}};return e[l].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=n,t.d=function(e,n,l){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:l})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var l=Object.create(null);if(t.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(l,o,function(n){return e[n]}.bind(null,o));return l},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=4)}([function(e,n,t){"use strict";t.r(n),t.d(n,"mean_std",(function(){return l})),t.d(n,"only_std",(function(){return o})),t.d(n,"only_std_NZ",(function(){return i})),t.d(n,"mean_std_NZ",(function(){return r})),t.d(n,"array_mean_NZ",(function(){return a})),t.d(n,"arraySum",(function(){return s})),t.d(n,"arrayMax",(function(){return c}));const l=(e,n=!1)=>{const t=e.reduce((e,n)=>e+n,0)/e.length;return[t,Math.sqrt(e.reduce((e,n)=>e.concat((n-t)**2),[]).reduce((e,n)=>e+n,0)/(e.length-(n?0:1)))]},o=(e,n=!1)=>{const t=e.reduce((e,n)=>e+n,0)/e.length;return Math.sqrt(e.reduce((e,n)=>e.concat((n-t)**2),[]).reduce((e,n)=>e+n,0)/(e.length-(n?0:1)))},i=e=>{const n=a(e);return Math.sqrt(e.reduce((e,t)=>e.concat((t-n)**2),[]).reduce((e,n)=>e+n,0)/e.length)},r=e=>{const n=a(e);return[n,Math.sqrt(e.reduce((e,t)=>e.concat((t-n)**2),[]).reduce((e,n)=>e+n,0)/e.length)]};function a(e){let n=0,t=0;for(let l in e)e[l]>0&&(n+=e[l],t++);return n/t}function s(e){let n=0;for(let t in e)n+=e[t];return n}function c(e){let n=e.length,t=-1/0;for(;n--;)e[n]>t&&(t=e[n]);return t}},function(e,n,t){"use strict";t.r(n),t.d(n,"formant_features",(function(){return c})),t.d(n,"straighten_formants",(function(){return d})),t.d(n,"get_ranked_formants",(function(){return u})),t.d(n,"clear_fm",(function(){return _})),t.d(n,"accumulate_fm",(function(){return f}));const l=t(0),o=[3,4,6,9],i=o.length;var r=[];let a=0,s=0;function c(e){try{const n=e.length,t=3,o=3;let i=new Array(o).fill(0),r=new Array(o).fill(0),a=new Array(o).fill(0),s=new Array(o).fill(0),c=new Array(o).fill(0),d=new Array(o).fill(0),u=new Array(o).fill(0),_=new Array(o).fill(0),f=new Array(o).fill(0),g=new Array(o).fill(0),m=new Array(o).fill(0),p=new Array(o).fill(0),h=new Array(o).fill(0);for(let y=0;y<o;y++){let o=!1,w=[],b=[],v=[],I=[],x=[],S=0,E=0;for(let l=0;l<n;l++){let n=e[l][y*t],c=e[l][y*t+1];if(n>0&&c>0){let d=e[l][y*t+2];if(w.push(n*c),b.push(n),I.push(d*c),v.push(c),o){let o=n-e[l-1][y*t];o>1?a[y]+=o:o<-1&&(s[y]+=-1*o),c>E?(E=c,S=1):1==S&&c<E/2&&(E>10&&x.push(E),E=0,S=-1)}o||(r[y]+=1),o=!0,i[y]+=1}else o=!1,S=0,E=0}if(r[y]>0){a[y]/=r[y],s[y]/=r[y];let e=l.arraySum(v);if(u[y]=Math.sqrt(e/n),_[y]=Math.sqrt(e/i[y]),c[y]=l.arraySum(w)/e,d[y]=l.only_std_NZ(b),f[y]=l.arraySum(I)/e,g[y]=x.length,g[y]>0){let e=l.mean_std_NZ(x);m[y]=Math.sqrt(e[0]),h[y]=Math.sqrt(e[1])/m[y],p[y]=m[y]/_[y],g[y]/=r[y]}i[y]/=r[y]}}let y=[];y.push(n);for(let e=0;e<o;e++)y.push(c[e]),y.push(d[e]),y.push(u[e]),y.push(_[e]),y.push(f[e]),y.push(i[e]),y.push(r[e]),y.push(a[e]),y.push(s[e]),y.push(g[e]),y.push(m[e]),y.push(h[e]),y.push(p[e]);return y}catch(e){return console.error(e),null}}function d(e,n,t){let l=[],o=[],i=[],r=[];for(let e=0;e<n;e++)l.push(new Array(18).fill(0)),o.push(new Array(3).fill(0)),i.push(new Int32Array(6).fill(0)),r.push(new Int32Array(6).fill(0));for(let n=0;n<e.length;n++)for(let a=0;a<e[n][14];a++){const s=e[n][7][a],c=e[n][10][a];let d=e[n][12][a],u=!1;for(let _=0;_<6;_++){let f=3*_,g=3*_+1,m=3*_+2;if(r[s][_]<t||Math.abs(c-i[s][_]/r[s][_])<10){if(0==l[s][g])u=!0;else if(l[s][g]<d){for(let e=5;e>_;e--)l[s][3*e]=l[s][3*(e-1)],l[s][3*e+1]=l[s][3*(e-1)+1],l[s][3*e+2]=l[s][3*(e-1)+2];u=!0}if(u){const t=e[n][9][a]-e[n][8][a]+1;l[s][f]=c,l[s][g]=d,l[s][m]=t,i[s][_]+=c*d,r[s][_]+=d,o[s][0]+=c*d,o[s][1]+=d,o[s][2]+=t*d;break}}}}return[l,o]}function u(){let e=[];for(let n=0;n<r.length;n++){if(r[n][14]>=3){let t=r[n][15]/r[n][13];if(t>=7){let l=0;if(0==e.length)e.push(r[n]);else{for(;l<e.length;){if(e[l][15]/e[l][13]>t){e.splice(l,0,r[n]);break}l++}l==e.length&&e.push(r[n])}}}}return e}function _(){r=null,r=[],a=0,s=0}function f(e,n,t,l,c){let d=n.length;if(d<1)return;let u=new Array(d).fill(-1),_=new Array(d).fill(0);a+=l;for(let l=0;l<r.length;l++){let a=t-r[l][3];if(a>=0&&a<i){let t=r[l][7].length;for(let i=0;i<d;i++){let s=Math.abs(r[l][5]-n[i][2]);if(s<o[a]){let o=g(a,s,t,r[l][5],n[i][2],r[l][6],e[n[i][2]],r[l][4]);o>1&&o>_[i]&&(_[i]=o,u[i]=l)}}}}for(let l=0;l<r.length;l++){let o=[];for(let e=0;e<d;e++)u[e]==l&&o.push(e);if(o.length>0){let i=n[o[0]][2],d=e[i];if(d>c){let c=n[o[0]][0],u=n[o[0]][1];for(let t=0;t<o.length;t++)n[o[t]][1]>u&&(u=n[o[t]][1]),n[o[t]][0]<c&&(c=n[o[t]][0]),e[n[o[t]][2]]>e[i]&&(i=n[o[t]][2]);let _=0;for(let n=c;n<=u;n++)_+=e[n];_=_;let f=r[l][10].length;f>=3?r[l][4]=(i-r[l][10][f-1]+(r[l][10][f-2]-r[l][10][f-1])+(r[l][10][f-3]-r[l][10][f-2]))/3:2==f?r[l][4]=(i-r[l][10][f-1]+(r[l][10][f-2]-r[l][10][f-1]))/2:1==f&&(r[l][4]=i-r[l][10][f-1]),r[l][0]=c,r[l][1]=u,r[l][2]=t,r[l][3]=t,r[l][5]=i,r[l][6]=d,r[l][7].push(t),r[l][8].push(c),r[l][9].push(u),r[l][10].push(i),r[l][11].push(d),r[l][12].push(_),r[l][13]+=_,r[l][14]+=1,r[l][15]+=_*i,r[l][16]=0,r[l][17]+=u-c+1,a-=_,s+=_}}}for(let l=0;l<d;l++)if(-1==u[l]){let o=n[l][2],i=e[o];if(i>c){let a=n[l][0],s=n[l][1],c=0;for(let n=a;n<=s;n++)c+=e[n];c=c;let d=[];d[0]=a,d[1]=s,d[2]=t,d[3]=t,d[4]=0,d[5]=o,d[6]=i,d[7]=[t],d[8]=[a],d[9]=[s],d[10]=[o],d[11]=[i],d[12]=[c],d[13]=c,d[14]=1,d[15]=c*o,d[16]=0,d[17]=s-a+1,r.push(d)}}}function g(e,n,t,l,o,i,r,a){let s=0;if(i>=r)s=r/i;else{if(!(r>0))return 0;s=i/r}if(0==e)return s>.1?300*s/n:0;{if(s<.001)return 0;s>=1?s=10:s<.1?s=1:s*=10;let n=10-Math.abs(o-l-a);if(n<0)return 0;n<1&&(n=1);let i=t;return i>10&&(i=10),10/e*(n*n+i*s)}}},function(e,n,t){"use strict";t.r(n),t.d(n,"if_file_in_db",(function(){return r})),t.d(n,"StoreFeatures",(function(){return a})),t.d(n,"collect_db_data",(function(){return c})),t.d(n,"get_label_heads",(function(){return u})),t.d(n,"Refresh_Table",(function(){return g})),t.d(n,"shows_stats_table",(function(){return p})),t.d(n,"update_true_label",(function(){return y})),t.d(n,"update_pred_label",(function(){return w})),t.d(n,"clear_labels",(function(){return b})),t.d(n,"clear_db_store",(function(){return v})),t.d(n,"Download_DB_JSON",(function(){return I})),t.d(n,"Load_JSON_Data",(function(){return S}));const l=t(3);var o=[],i=[];function r(e,n){let t=String(e)+"#"+n;return t=t+"#"+String(0),!!window.localStorage.getItem(t)}function a(e,n,t,l,o,i){let r=String(n)+"#"+l[0];r=r+"#"+String(t),5!=e&&7!=e||40==i.length||alert("Invalid feature length "+i.length),window.localStorage.setItem(r,JSON.stringify(i)),window.localStorage.setItem("ts_"+r,JSON.stringify(o)),s(n,r)}function s(e,n){let t="_a_"+String(e),l=window.localStorage.getItem(t);l=l?JSON.parse(l):[],l.indexOf(n)<0&&(l.push(n),window.localStorage.setItem(t,JSON.stringify(l)))}function c(e){let n="_a_"+String(e),t=window.localStorage.getItem(n);if(t){d();let e=[],n=[],l=[],o=[],i=[],r=[];t=JSON.parse(t);for(let a=0;a<t.length;a++){let s=window.localStorage.getItem(t[a]);if(s){s=JSON.parse(s);let c=JSON.parse(window.localStorage.getItem("ts_"+t[a])),d=h(t[a]),u=d[1];d=d[0];let _=window.localStorage.getItem("pred_"+t[a]);_=_?JSON.parse(_):null,e.push(t[a]),n.push(c),l.push(s),o.push(u),i.push(d),r.push(_)}else console.warn("Missing an indexed feature DB: "+t[a])}return[e,n,l,o,i,r]}return console.warn("No data in DB"),null}function d(){try{let e=document.getElementById("class_labels").value;e&&(e=JSON.parse(document.getElementById("class_labels").value)),null!==e&&(o=0==e.length?[]:e);let n=document.getElementById("ordinal_labels").value;n&&(n=JSON.parse(n)),null!==n&&(i=0==n.length?[]:n)}catch(e){alert(e)}}function u(){return d(),[o,i]}var _=0,f=0;async function g(e,n){if(n){d();let n=c(e);document.getElementById("table_div").innerHTML="";let t='<table id="table_0" class="center w3-table w3-bordered" style="table-layout: fixed;">\n        <tr> <th style="width:30px;">#</th>\n        <th style="width:70px;">File</th>\n        <th style="width:30px;"><sub>Part</sub></th>\n        <th style="width:30px;">N<sub>f</sub></th>\n        <th style="width:30px;">t<sub>0</sub></th>\n        <th style="width:30px;">t<sub>len</sub></th>\n        <th style="width:20px;"><sub>Init</sub></th>';for(let e=0;e<o.length;e++)t+=`<th style="width:40px;"><i>${Object.keys(o[e])[0]}</i></th>`;for(let e=0;e<i.length;e++)t+=`<th style="width:40px;"><i>${i[e]}</i></th>`;if(t+='<th style="width:30px;">Pred</th> </tr>',document.getElementById("table_div").innerHTML=t,n){_=1,f++;for(let e=0;e<n[0].length;e++){let t=n[0][e],l=t.split("#"),o=l[1],i=parseInt(l[2])+1,r=n[2][e].length,a=parseFloat(n[1][e][0]).toFixed(2),s=parseFloat(n[1][e][1]).toFixed(2),c=n[3][e]&&Object.keys(n[3][e]).length>0,d=n[4][e],u=n[5][e];const _=f;setTimeout((function(){m(_,e+1,t,o,i,r,a,s,c,d,u)}),5*e)}p(n),n=null,t=null}}else document.getElementById("table_div").innerHTML="",document.getElementById("results_div").innerHTML=""}function m(e,n,t,l,r,a,s,c,d,u,g){if(e!=f)return;let m="",p=document.getElementById("table_0").insertRow(_);_++;let h=0,y=p.insertCell(h);h++,y.innerHTML=""+n,y=p.insertCell(h),h++,y.innerHTML=`<button onclick="FASER.play_file_sample('${l}')" class='w3-button w3-tiny w3-border w3-round w3-padding-small'>${l.substring(0,15)}</button>`,y=p.insertCell(h),h++,y.innerHTML=`<button onclick="FASER.play_file_sample('${l}',${s},${c})" class='w3-button w3-tiny w3-border w3-round w3-padding-small'>${r}</button>`,y=p.insertCell(h),h++,y.innerHTML=""+a,y=p.insertCell(h),h++,y.innerHTML=""+s,y=p.insertCell(h),h++,y.innerHTML=""+c,y=p.insertCell(h),h++,y.innerHTML=d?"1":"0";let w=0;const b="r_"+t+"_";for(let e=0;e<o.length;e++){const n=Object.keys(o[e])[0];let l=u&&u[0]&&u[0][n]?u[0][n]:NaN,i=o[e][n].indexOf(l);null==l&&(l=NaN),y=p.insertCell(h),h++;let r="#8F0B0B";if(o[e][n].indexOf("*")>=0?r="#FFFFFF":i>=0?r="#FFF200":isNaN(l)&&(r="#FF000047"),y.innerHTML=`<input type="text"  id="${b+n}" style="width:30px; background-color:black; color:${r};" value="${l}" onchange="FASER.dx_label('${t}', '${n}', this.value)">`,g&&g[0]&&g[0][n]){let e=g[0][n];y.innerHTML+=e==l?`&nbsp:&nbsp<span style="color:green;">${e}<span>`:`&nbsp:&nbsp<span style="color:red;">${e}<span>`,w++}}for(let e=0;e<i.length;e++){const n=i[e];let l=u&&u[1]&&u[1][n]?u[1][n]:NaN;if(m="",isNaN(l)||null==l)l=NaN,m+=`<input type="range" min="0" max="100" value="${l}" step="5" class="slider hideDiv" \n            id="${b+n}" \n            onchange="FASER.dx_label('${t}', '${n}', this.value)">\n            <small class="hide" id="${b+n}_i">&nbsp${n}:${l}</small>\n            </input>`;else{let e="rgb("+String(255-255*l)+", "+String(255*l)+","+String(60*l)+")";l=Math.round(100*l),m+=`<input type="range" min="0" max="100" value="${l}" step="5" class="slider hideDiv" \n            id="${b+n}" style="background-color:${e};" \n            onchange="FASER.dx_label('${t}', '${n}', this.value)">\n            <small class="hide" id="${b+n}_i">&nbsp${n}:${l}</small>\n            </input>`}if(g&&g[1]&&g[1][n]){m+="<br>";let e=g[1][n];if(isNaN(e)||null==e)e=NaN,m+=`<input type="range" min="0" max="100" value="${e}" class="slider hideDiv"  disabled>\n                <small class="hide" >&nbsp${n}:${e}</small>\n                </input>`;else{let t="rgb("+String(255-255*e)+", "+String(255*e)+","+String(60*e)+")";e=Math.round(100*e),m+=`<input type="range" min="0" max="100" value="${e}" class="slider hideDiv" \n                style="background-color:${t};" disabled>\n                <small class="hide" >&nbsp${n}:${e}</small>\n                </input>`,w++}}y=p.insertCell(h),h++,y.innerHTML=m}m="",y=p.insertCell(h),h++,y.innerHTML=""+w,m=null,y=null,p=null}function p(e=null,n=null){if(e||(d(),n&&(e=c(n))),e){const n=document.getElementById("results_div");n.innerHTML="";let t='<div class="center-content w3-container">';for(let n=0;n<o.length;n++){const l=Object.keys(o[n])[0];let i=[],r={},a={},s={},c=[0,0,0];for(let t=0;t<e[0].length;t++)e[4][t]&&e[4][t][0][l]&&(o[n][l].indexOf(e[4][t][0][l])>=0||o[n][l].indexOf("*")>=0)&&(i.indexOf(e[4][t][0][l])<0&&(i.push(e[4][t][0][l]),r[e[4][t][0][l]]=0,a[e[4][t][0][l]]=0,s[e[4][t][0][l]]=0),r[e[4][t][0][l]]++,e[5][t]&&e[5][t][0]&&e[5][t][0][l]?e[4][t][0][l]==e[5][t][0][l]?(c[0]++,a[e[4][t][0][l]]++):(c[1]++,s[e[4][t][0][l]]++):c[2]++);const d=(100*c[0]/(c[0]+c[1])).toFixed(2);t+=`<div class="w3-cell w3-border w3-border-pink w3-half"><ul>\n                        <li>Label: ${l}</li>\n                        <li>Type: Class</li>`,t+=`<li>Classes: ${i}</li>\n                        <li>Accuracy: <span class="w3-tag w3-round w3-blue">${d}%</span></li>\n                      <li>Correct: ${c[0]}, Wrong ${c[1]}, NaN: ${c[2]}</li>`;for(let e=0;e<i.length;e++){const n=(100*a[i[e]]/(s[i[e]]+a[i[e]])).toFixed(2);t+=`<li>${i[e]} : <span> ${r[i[e]]}</span>\n                 <span class="w3-tag w3-small w3-round w3-green">${a[i[e]]} </span>\n                 <span class="w3-tag w3-small w3-round w3-red">${s[i[e]]} </span>\n                 <span class="w3-tag w3-small w3-round w3-blue">${n}% </span>\n                 </li>`}t+="</ul></div>"}t+='</div><div class="center-content w3-container">';for(let n=0;n<i.length;n++){const l=i[n];let o=0,r=0,a=0,s=1/0,c=0;for(let n=0;n<e[0].length;n++)e[4][n]&&e[4][n][1][l]&&0==(isNaN(e[4][n][1][l])||null==e[4][n][1][l])&&(r++,e[4][n][1][l]<s&&(s=e[4][n][1][l]),e[4][n][1][l]>c&&(c=e[4][n][1][l]),e[5][n]&&e[5][n][1]&&e[5][n][1][l]&&0==(isNaN(e[5][n][1][l])||null==e[5][n][1][l])&&(a++,o+=Math.pow(e[5][n][1][l]-e[4][n][1][l],2)));o=a>0?o/a:0,o=Math.sqrt(o),t+=`<div class="w3-cell w3-border w3-border-orange w3-third"><ul>\n                        <li>Label: ${l}</li>\n                        <li>Type: Ordinal</li>`,t+=`<li>Range: ${s} - ${c}</li>\n                        <li>Samples: ${r}</li>\n                        <li>Predicted: ${a}</li>\n                        <li>RMSE: ${o.toFixed(3)}</li>`,t+="</ul></div>"}let l=new Date;return l=l.getHours()+":"+l.getMinutes()+":"+l.getSeconds(),t+=`<p class="w3-text-gray w3-small"><br>Stats generated at: ${l}</p>`,t+="</div>",n.innerHTML=t,void(t=null)}document.getElementById("results_div").innerHTML='<p class="w3-center w3-tiny">No prediction results yet.</p>'}function h(e){let n=null,t=window.localStorage.getItem("true_"+e);return t?t=JSON.parse(t):(n=l.label_from_filename(e),n&&x(n[0])&&x(n[1])&&(t=n)),[t,n]}function y(e,n,t){console.log("update_true_label");let l=h(e)[0];l||(l=[{},{}]);let r=!1;const a="r_"+e+"_"+n;for(let e=0;e<o.length;e++)if(Object.keys(o[e])[0]==n){l[0]||(l[0]={}),l[0][n]=t,document.getElementById(a).style.color="white",r=!0;break}if(0==r)for(let e=0;e<i.length;e++)if(i[e]==n){let e=parseInt(t)/100;l[1]||(l[1]={}),l[1][n]=parseInt(t)/100;let o="rgb("+String(255-255*e)+", "+String(255*e)+","+String(60*e)+")";document.getElementById(a).style.backgroundColor=o,document.getElementById(a+"_i").innerText=n+":"+String(t);break}console.log(l),window.localStorage.setItem("true_"+e,JSON.stringify(l))}function w(e,n,t){let l=window.localStorage.getItem("pred_"+e);l=null==l?[{},{}]:JSON.parse(l);let r=!1;for(let e=0;e<o.length;e++)if(Object.keys(o[e])[0]==n){l[0][n]=t,r=!0;break}if(0==r)for(let e=0;e<i.length;e++)if(i[e]==n){l[1][n]=t;break}window.localStorage.setItem("pred_"+e,JSON.stringify(l))}function b(e,n=!0,t=!0){let l="_a_"+String(e);console.log("Clearing labels for DB: "+l);let o=window.localStorage.getItem(l);if(o){o=JSON.parse(o);for(let e=0;e<o.length;e++)n&&window.localStorage.removeItem("true_"+o[e]),t&&window.localStorage.removeItem("pred_"+o[e])}}function v(){window.localStorage.clear(),f=0}function I(e){console.log("Collecting features file"),document.getElementById("msg").textContent="Collecting features...";let n=c(e);if(n){let e=n[0].length,t=[];for(let l=0;l<e;l++){let e=n[0][l].split("#"),o={file:e[1],seg:e[2],time:n[1][l],features:n[2][l],origin:n[3][l],true:n[4][l],pred:n[5][l]};t.push(o)}console.log("Downloading data file"),document.getElementById("msg").textContent="Exporting data JSON",function(e){var n=new Blob([JSON.stringify(e)],{type:"text/plain;charset=utf-8"});if(e=null,!document.documentMode){var t=(window.URL||window.webkitURL).createObjectURL(n),l=document.createElement("a");l.download="data.json",l.href=t,document.body.appendChild(l),l.click(),document.getElementById("msg").textContent="JSON download started",document.body.removeChild(l)}else window.navigator.msSaveBlob(n,"data.json")}(t),t=null}else console.warn("No data in DB"),document.getElementById("msg").textContent="No data to export"}function x(e){return e&&"object"==typeof e&&e.constructor===Object}function S(e,n){let t=JSON.parse(n);if(t&&t[0]&&t[0].file&&t[0].features){let n=t.length;for(let l=0;l<n;l++){let n=String(e)+"#"+t[l].file+"#"+t[l].seg;40!=t[l].features.length&&alert("Invalid feature length "+t[l].features.length),window.localStorage.setItem(n,JSON.stringify(t[l].features)),window.localStorage.setItem("ts_"+n,JSON.stringify(t[l].time)),t[l].true&&x(t[l].true[0])&&x(t[l].true[1])&&window.localStorage.setItem("true_"+n,JSON.stringify(t[l].true)),t[l].pred&&x(t[l].pred[0])&&x(t[l].pred[1])&&window.localStorage.setItem("pred_"+n,JSON.stringify(t[l].pred)),s(e,n)}document.getElementById("msg").textContent="Loaded "+String(n)+" samples from JSON"}else alert("Invalid data file")}},function(e,n,t){"use strict";t.r(n),t.d(n,"Load_JSON_Labels_file",(function(){return i})),t.d(n,"label_from_filename",(function(){return r}));var l=null;let o=!1;function i(e){let n=JSON.parse(e);if(n)if(n[0]&&n[0].i){const e=(l=n).length;o=!0,document.getElementById("msg").textContent="Loaded "+String(e)+" labels from JSON"}else alert("Invalid label file")}function r(e){if(e){if(o){let n=e.split("#")[1];for(let e=0;e<l.length;e++)if(l[e].i==n){return[{emotion:l[e].emo,sex:l[e].sex,spkr:l[e].spkr,U:l[e].U},{V:l[e].V,A:l[e].A,D:l[e].D}]}return console.log("Not found "+n),null}return null}return console.error("Error: Filename is required to extract emo labels."),null}},function(e,n,t){"use strict";t.r(n),t.d(n,"refresh_db_table",(function(){return _})),t.d(n,"clear_db_table",(function(){return f})),t.d(n,"download_db_table",(function(){return g})),t.d(n,"start_nn_training",(function(){return m})),t.d(n,"start_nn_prediction",(function(){return p})),t.d(n,"download_nn_model",(function(){return h})),t.d(n,"load_files_nn_model",(function(){return y})),t.d(n,"dx_label",(function(){return w})),t.d(n,"clear_labels",(function(){return b})),t.d(n,"play_file_sample",(function(){return v})),t.d(n,"readmultifiles",(function(){return k})),t.d(n,"data_collect_en",(function(){return $})),t.d(n,"ML_train_en",(function(){return P})),t.d(n,"update_settings",(function(){return C}));const l=t(5),o=t(2),i=t(3),r=t(10),a=document.querySelector("#SpectrumCanvas").getContext("2d");var s={offline:!1,plot_enable:!0,spec_type:1,process_level:6,plot_len:200,f_min:50,f_max:4e3,N_fft_bins:256,N_mel_bins:128,window_width:25,window_step:25,pause_length:200,min_seg_length:50,plot_lag:1,pre_norm_gain:1e3,high_f_emph:0,slow:!0,DB_ID:1,collect:!0,ML_en:!0},c={playing:!1,files_processed:0,current_file_index:0,Source:1},d=null;async function u(e,n,t,l){if(s.collect)if(7==s.process_level){t.length!=l.length&&console.error("Length mismatch");for(let i=0;i<l.length;i++)o.StoreFeatures(s.process_level,s.DB_ID,e+i/100,n,t[i],l[i])}else if(6==s.process_level){t.length!=l.length&&console.error("Length mismatch");for(let i=0;i<l.length;i++)o.StoreFeatures(s.process_level,s.DB_ID,e+i/100,n,t[i],l[i])}else(5==s.process_level||4==s.process_level)&&o.StoreFeatures(s.process_level,s.DB_ID,e,n,t,l)}function _(){o.Refresh_Table(s.DB_ID,s.collect),r.make_ML_div(s.ML_en),document.getElementById("db_settings_model").style.display="none"}function f(){confirm("Clear all the stored data?")&&(o.clear_db_store(),_(),console.log("Data cleared"))}function g(){o.Download_DB_JSON(s.DB_ID)}function m(e,n){r.train_nn(s.DB_ID,e,n)}function p(e,n){r.predict_db_nn(s.DB_ID,e,n)}function h(e,n){r.download_nn_model(e,n)}function y(e,n,t){r.load_single_nn(n,t,!0,e,null)}function w(e,n,t){o.update_true_label(e,n,t)}function b(e=!0,n=!0){o.clear_labels(s.DB_ID,e,n)}function v(e,n=null,t=null,o=!0,i=null){if(!d)return alert("First load the selected file in the drop zone."),!1;let r=-1;for(var a=0,s=d.length;a<s;a++)if(d[a].name===e){r=a;break}if(r<0)return alert("File not loaded in the drop zone:\t"+String(e)),!1;c.playing&&(E("New file play"),c.Source=1),c.current_file_index=r;let u=new FileReader;return u.onload=function(e){let r=d[c.current_file_index].name,a=d[c.current_file_index].type;if(!a.includes("audio/")&&!a.includes("video/"))return document.getElementById("msg").textContent="Invalid format: "+String(r)+", "+String(a),!1;document.getElementById("msg").textContent="Playing file "+String(c.current_file_index+1)+"/"+String(d.length),S(),c.playing=!0,l.LaunchAudioNodes(e.target.result,i,[r],!1,1,o,n,t).then((function(){return E("Finished processing sample"),document.getElementById("msg").textContent="Finished playing: "+String(r),e=null,u=null,!0})).catch(e=>(console.log(e),E("Error during play start"),document.getElementById("msg").textContent="Error playing: "+String(r),!1))},u.readAsArrayBuffer(d[c.current_file_index]),!0}function I(){if(c.current_file_index>=d.length)return!1;let e=new FileReader;return e.onload=function(n){let t=d[c.current_file_index].name;if(s.collect&&s.offline&&o.if_file_in_db(s.DB_ID,t))return document.getElementById("msg").textContent="Skipping file "+String(c.current_file_index+1)+"/"+String(d.length),x(),!0;let i=d[c.current_file_index].type;if(!i.includes("audio/")&&!i.includes("video/"))return document.getElementById("msg").textContent="Invalid format: "+String(t)+", "+String(i),!1;document.getElementById("msg").textContent="Playing file "+String(c.current_file_index+1)+"/"+String(d.length),l.LaunchAudioNodes(n.target.result,u,[t],s.offline,1,!1,null,null).then((function(){return n=null,e=null,x(),!0})).catch(e=>(console.log(e),E("Error during play start"),document.getElementById("msg").textContent="Error playing: "+String(t),!1))},e.readAsArrayBuffer(d[c.current_file_index]),!0}function x(){if(c.files_processed++,c.files_processed<d.length){if(c.playing&&(c.current_file_index++,c.current_file_index<d.length)){console.log("Next file: "+String(c.current_file_index));let e=10;c.current_file_index%100==0?e=2e3:c.current_file_index%30==0?e=1e3:c.current_file_index%10==0?e=50:c.current_file_index%5==0&&(e=20),e*=s.slow?10:1,setTimeout(I,e)}}else E("Finished processing all files"),document.getElementById("msg").textContent="Finished playing "+String(c.files_processed)+" files",window.setTimeout(_,1e3)}function S(){l.configure(s.spec_type,s.process_level,s.f_min,s.f_max,s.N_fft_bins,s.N_mel_bins,s.window_width,s.window_step,s.pre_norm_gain,s.high_f_emph,s.pause_length,s.min_seg_length,s.plot_enable,s.plot_len,s.plot_lag,a,1200,400)}function E(e){c.playing=!1,l.StopAudioNodes(e),document.getElementById("play_button").value="Play",document.getElementById("demo_button").value="Demo",document.getElementById("mic_button").value="Mic",document.getElementById("demo_button").disabled=!1,document.getElementById("play_button").disabled=!1,document.getElementById("mic_button").disabled=!1}function B(e){if(2!=c.Source&&0==c.playing&&(E("Source change"),c.Source=2),2==c.Source)if(0==c.playing){var n=new Audio(e);function t(){E("Web play ended")}n.crossOrigin="anonymous",document.getElementById("msg").textContent="Loading audio...",N(!0),document.getElementById("demo_button").value="...",n.addEventListener("canplaythrough",e=>{n.addEventListener("ended",t,!1),document.getElementById("msg").textContent="Playing audio...",document.getElementById("demo_button").value="Stop",document.getElementById("demo_button").disabled=!1,c.playing=!0,S(),l.LaunchAudioNodes(n,u,["demo"],!1,2,!1).then((function(){E("End Sop play"),document.getElementById("msg").textContent="Finished playing"})).catch(e=>{console.log(e),E("Error during play start"),document.getElementById("msg").textContent="Error playing"})})}else E("Button pressed"),document.getElementById("msg").textContent="Stopped";else console.log("Invalid source parameter")}function N(e){document.getElementById("demo_button").disabled=e,document.getElementById("play_button").disabled=e,document.getElementById("mic_button").disabled=e}function k(e){c.playing&&E("New file loaded"),d=null,c.current_file_index=0,c.files_processed=0,d=e,document.getElementById("msg").textContent="Total "+String(d.length)+" files loaded"}document.querySelector("#demo_button").addEventListener("click",(function(e){e.preventDefault(),B("263771__shadowisp__rpg-female-protagonist-lines-2.wav")})),document.querySelector("#mic_button").addEventListener("click",(function(e){e.preventDefault(),3!=c.Source&&0==c.playing&&(E("Source change"),c.Source=3),3==c.Source?0==c.playing?(document.getElementById("msg").textContent="Streaming from mic...",N(!0),document.getElementById("mic_button").value="...",document.getElementById("mic_button").value="Stop",document.getElementById("mic_button").disabled=!1,c.playing=!0,S(),l.LaunchAudioNodes(null,u,["mic"],!1,3,!0,null,null).then((function(){E("End sop play")})).catch(e=>{console.log(e),E("Error during play start"),document.getElementById("msg").textContent="Error streaming"})):(E("Button pressed"),document.getElementById("msg").textContent="Stopped"):console.log("Invalid source parameter")})),document.querySelector("#play_button").addEventListener("click",(function(e){e.preventDefault(),1!=c.Source&&0==c.playing&&(E("Source change"),c.Source=1),1==c.Source?c.playing?(E("Button pressed"),document.getElementById("msg").textContent="Stopped"):d?(N(!0),c.current_file_index=0,c.files_processed=0,I()&&(c.playing=!0,document.getElementById("play_button").value="Stop",document.getElementById("play_button").disabled=!1,document.getElementById("msg").textContent="Playing")):document.getElementById("msg").textContent="No files selected to play":console.log("Invalid source parameter")}));var M=function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy"},A=function(e){e.preventDefault(),e.stopPropagation(),k(e.dataTransfer.files)};function $(e){s.collect=e,document.getElementById("ML_train_en").disabled=!s.collect,0==s.collect&&(document.getElementById("ML_train_en").checked=!1,s.ML_en=!1),_()}function P(e){s.ML_en=e,r.make_ML_div(s.ML_en)}function C(){s.offline=document.getElementById("offline").checked,s.spec_type=parseInt(document.getElementById("spec_type").value),s.process_level=parseInt(document.getElementById("process_level").value),s.plot_enable=document.getElementById("plot_enable").checked,s.plot_len=parseInt(document.getElementById("plot_len").value),s.f_min=parseInt(document.getElementById("f_min").value),s.f_max=parseInt(document.getElementById("f_max").value),s.N_fft_bins=parseInt(document.getElementById("N_fft_bins").value),s.N_mel_bins=parseInt(document.getElementById("N_mel_bins").value),s.window_width=parseInt(document.getElementById("window_width").value),s.window_step=parseInt(document.getElementById("window_step").value),s.pause_length=parseInt(document.getElementById("pause_length").value),s.min_seg_length=parseInt(document.getElementById("min_seg_length").value),s.pre_norm_gain=parseInt(document.getElementById("pre_norm_gain").value),s.high_f_emph=parseFloat(document.getElementById("high_f_emph").value),s.plot_lag=parseInt(document.getElementById("plot_lag").value),s.f_min=s.f_min<0?0:s.f_min,s.f_max=s.f_max<20?20:s.f_max,s.f_max=s.f_max>2e4?2e4:s.f_max,s.f_min=s.f_min>=s.f_max?parseInt(s.f_max/4):s.f_min,s.N_fft_bins=s.N_fft_bins<8?8:s.N_fft_bins,s.N_mel_bins=s.N_mel_bins>s.N_fft_bins?s.N_fft_bins:s.N_mel_bins,s.N_mel_bins=s.N_mel_bins<4?4:s.N_mel_bins,s.window_width=s.window_width<5?5:s.window_width,s.window_width=s.window_width>1e3?1e3:s.window_width,s.window_step=s.window_step<5?5:s.window_step,s.window_step=s.window_step>1e3?1e3:s.window_step,s.pause_length=s.pause_length<2*s.window_step?2*s.window_step:s.pause_length,s.min_seg_length=s.min_seg_length<4*s.window_step?4*s.window_step:s.min_seg_length,s.plot_lag=s.plot_lag<0?0:s.plot_lag,F(),S(),document.getElementById("settings_model").style.display="none",console.log(s)}function F(){s.collect=document.getElementById("data_collect_en").checked,s.ML_en=document.getElementById("ML_train_en").checked,document.getElementById("ML_train_en").disabled=!s.collect,document.getElementById("offline").checked=s.offline,document.getElementById("spec_type").value=s.spec_type,document.getElementById("process_level").value=s.process_level,document.getElementById("plot_enable").checked=s.plot_enable,document.getElementById("plot_len").value=s.plot_len,document.getElementById("f_min").value=s.f_min,document.getElementById("f_max").value=s.f_max,document.getElementById("N_fft_bins").value=s.N_fft_bins,document.getElementById("N_mel_bins").value=s.N_mel_bins,document.getElementById("window_width").value=s.window_width,document.getElementById("window_step").value=s.window_step,document.getElementById("pause_length").value=s.pause_length,document.getElementById("min_seg_length").value=s.min_seg_length,document.getElementById("pre_norm_gain").value=s.pre_norm_gain,document.getElementById("high_f_emph").value=s.high_f_emph,document.getElementById("plot_lag").value=s.plot_lag,s.plot_enable?document.getElementById("canvas_div").style.display="block":document.getElementById("canvas_div").style.display="none"}document.getElementById("up_data_file").addEventListener("change",(function(e){let n=e.target.files[0];var t=new FileReader;t.onload=function(e){o.Load_JSON_Data(s.DB_ID,e.target.result),_()},t.readAsText(n)}),!1),document.getElementById("up_labels_file").addEventListener("change",(function(e){let n=e.target.files[0];var t=new FileReader;t.onload=function(e){i.Load_JSON_Labels_file(e.target.result),_()},t.readAsText(n)}),!1),window.onload=function(){F(),function(){window.File&&window.FileReader&&window.FileList&&window.Blob||console.warn("The Drag and Drop File APIs are not fully supported in this browser.");const e=document.getElementById("dropZone");e.addEventListener("drop",A,!1),e.addEventListener("dragover",M,!1)}(),S(),document.getElementById("table_div").innerHTML='<div class="w3-animate-fading">Loading...</div>',setTimeout(_,1e3),console.log("Ready"),N(!1);const e=new URLSearchParams(document.location.search.substring(1));if(e.has("mode")){let n=e.get("mode");n>0&&n<=5&&(s.process_level=n),F()}if(e.has("p")){let n=e.get("p");console.log("Playing external URL: "+n),B(n)}}},function(e,n,t){"use strict";t.r(n),t.d(n,"configure",(function(){return i})),t.d(n,"LaunchAudioNodes",(function(){return r})),t.d(n,"StopAudioNodes",(function(){return a})),t.d(n,"set_predicted_label_for_segment",(function(){return s}));const l=t(6);let o={plot_enable:!1,spec_type:1,process_level:4,plot_len:200,f_min:50,f_max:4e3,N_fft_bins:256,N_mel_bins:128,window_width:25,window_step:25,pause_length:250,min_seg_length:250,plot_lag:1,pre_norm_gain:1e3,high_f_emph:0,plot_canvas:null,canvas_width:200,canvas_height:100};function i(e=1,n=4,t=50,i=4e3,r=256,a=128,s=25,c=25,d=1e3,u=0,_=250,f=250,g=!1,m=100,p=0,h=null,y=null,w=null){if(o.spec_type=e,o.process_level=n,o.f_min=t,o.f_max=i,o.N_fft_bins=r,o.N_mel_bins=a,o.window_width=s,o.window_step=c,o.pre_norm_gain=d,o.high_f_emph=u,o.pause_length=_,o.min_seg_length=f,g){o.plot_enable=g,o.plot_len=m,o.plot_lag=p,o.plot_canvas=h,o.canvas_width=y,o.canvas_height=w;let e=1==o.spec_type?o.N_mel_bins:o.N_fft_bins;l.reset_plot(o.plot_enable,o.plot_canvas,o.canvas_width,o.canvas_height,o.spec_type,o.process_level,o.plot_len,e,o.plot_lag)}else o.plot_enable=!1}function r(e=null,n=null,t=[],i=!1,r=1,a=!0,s=null,c=null){return new Promise((d,u)=>{l.isNodePlaying()?u("Error: Already playing"):l.reset_nodes(o.spec_type,o.f_min,o.f_max,o.N_fft_bins,o.N_mel_bins,o.window_width,o.window_step,o.pre_norm_gain,o.high_f_emph).then((function(){let _=1==o.spec_type?o.N_mel_bins:o.N_fft_bins;l.reset_plot(o.plot_enable,o.plot_canvas,o.canvas_width,o.canvas_height,o.spec_type,o.process_level,o.plot_len,_,o.plot_lag).then((function(){let _=1==o.spec_type?o.N_mel_bins:o.N_fft_bins;l.reset_segmentor(o.process_level,_,o.plot_len,o.window_step,o.pause_length,o.min_seg_length,n,a,t).then((function(){1==r&&e?i?(l.Garbage_Collect(),l.offline_play_the_file(e,s,c).then((function(){d("Done")})).catch(e=>{console.error(e),u(e)})):l.online_play_the_file(e,s,c).then((function(){d("Done")})).catch(e=>{console.error(e),u(e)}):2==r&&e?l.online_play_the_sop(e,s,c).then((function(){d("Done")})).catch(e=>{console.error(e),u(e)}):3==r?l.online_play_the_mic().then((function(){d("Done")})).catch(e=>{console.error(e),u(e)}):u("Invalid audio source")})).catch(e=>{console.error(e),u(e)})})).catch(e=>{console.error(e),u(e)})})).catch(e=>{console.error(e),u(e)})})}function a(e="no reason"){l.disconnect_nodes(e)}function s(e,n,t){l.set_predicted_label_for_segment(e,n,t)}},function(e,n,t){"use strict";t.r(n),t.d(n,"reset_nodes",(function(){return c})),t.d(n,"reset_segmentor",(function(){return d})),t.d(n,"reset_plot",(function(){return u})),t.d(n,"online_play_the_mic",(function(){return _})),t.d(n,"online_play_the_sop",(function(){return f})),t.d(n,"online_play_the_file",(function(){return g})),t.d(n,"Garbage_Collect",(function(){return m})),t.d(n,"offline_play_the_file",(function(){return p})),t.d(n,"disconnect_nodes",(function(){return h})),t.d(n,"isNodePlaying",(function(){return y})),t.d(n,"set_predicted_label_for_segment",(function(){return I}));const l=t(7),o=t(9),i="./app_assets/dist/analyzernode.min.js";window.AudioContext=window.webkitAudioContext||window.AudioContext||window.mozAudioContext;var r={audioPlaying:0,PlayMode:0,last_node_ms:0,frames_ack:0,frames_analyzed:0,spec_bands:-1},a={spec_type:1,f_min:50,f_max:4e3,N_fft_bins:256,N_mel_bins:128,window_width:25,window_step:25,pre_norm_gain:1e3,high_f_emph:.05},s={plot_enable:!1,spec_type:1,process_level:4,plot_len:500,bins_count:128,bins_y_labels:[],axis_labels_sep:3,last_seg_len:0,plot_lag:3};function c(e,n,t,l,o,i,s,c,d){return new Promise((u,_)=>{o|l?(r.spec_bands=1==e?o:l,r.frames_ack=0,r.frames_analyzed=0,r.last_seg_len=0,r.PlayMode=0,a.spec_type=e,a.f_min=n,a.f_max=t,a.N_fft_bins=l,a.N_mel_bins=o,a.window_width=i,a.window_step=s,a.pre_norm_gain=c,a.high_f_emph=d,u("ready")):_("Invalid reset_nodes config")})}function d(e,n,t,o,i,r,a,s,c=[]){return new Promise((d,u)=>{l.reset_segmentation(e,n,t,o,i,r,a,s,c).then((function(){d("ready")})).catch((function(e){u("reset_segmentor failed: "+e)}))})}function u(e=!1,n=null,t=800,l=400,i=1,r=0,a=100,c=64,d=0){return new Promise((u,_)=>{r?(e&&n?(s.plot_enable=!0,s.spec_type=i,s.process_level=r,s.plot_len=a,s.plot_lag=d,s.bins_y_labels=[],s.bins_count=c,s.bins_count>32?s.axis_labels_sep=Math.round(s.bins_count/32):s.axis_labels_sep=0,o.init_canvas(n,t,l,a,c),o.clear_plot()):s.plot_enable=!1,u("ready")):_("Invalid reset_plot config")})}function _(){return new Promise((e,n)=>{var t,o,c;try{t=new AudioContext,o=null;let d={audio:!0,video:!1};navigator.mediaDevices.getUserMedia(d).then(d=>{o=t.createMediaStreamSource(d),r.audioPlaying=1,t.audioWorklet.addModule(i).then((function(){(c=new AudioWorkletNode(t,"spectrum-processor")).port.onmessage=i=>{if(Number.isInteger(i.data)?1==i.data&&(r.frames_ack+=i.data,r.frames_ack>r.frames_analyzed&&c&&c.port.postMessage(1)):i.data.bins_Hz?(s.bins_y_labels=i.data.bins_Hz,(r.spec_bands<=0||r.spec_bands!=s.bins_y_labels.length)&&n("Bins Init mismatch: "+String(r.spec_bands)+", "+String(s.bins_y_labels.length))):Uint32Array.prototype.isPrototypeOf(i.data)&&i.data.length>0&&(r.spec_bands<=0||r.spec_bands!=i.data.length?n("Bins count mismatch: "+String(r.spec_bands)+", "+String(i.data.length)):(l.spectrum_push(i.data,r.frames_analyzed),s.plot_enable&&requestAnimFrame(x),r.frames_analyzed++)),2==r.audioPlaying&&r.frames_analyzed>=r.frames_ack||-1==r.audioPlaying){-1==r.audioPlaying?console.log("Mic stream end by disconnect"):console.log("Mic stream end normal (b)"),r.audioPlaying=0,c&&c.port.postMessage(22);try{o.stop(0)}catch(i){}try{o.disconnect(c)}catch(i){}try{c.disconnect(t.destination)}catch(i){}t&&"closed"!=t.state&&t.close(),o=null,c=null,t=null,l.segment_truncate(),s.plot_enable&&requestAnimFrame(x),e("complete_d")}},c.port.postMessage(a),c.port.postMessage(0),o.onended=function(){console.log("Mic stream ended"),r.audioPlaying=2,c&&c.port.postMessage(22);try{o.stop(0)}catch(e){}try{o.disconnect(c)}catch(e){}if(o=null,r.frames_analyzed>=r.frames_ack&&0!=r.audioPlaying){console.log("Mic stream end normal"),r.audioPlaying=0;try{c.disconnect(t.destination)}catch(e){}t&&"closed"!=t.state&&t.close(),c=null,t=null,l.segment_truncate(),s.plot_enable&&requestAnimFrame(x),e("complete")}};try{o.connect(c),c.connect(t.destination),r.PlayMode=3}catch(e){console.log("File loading failed: "+e);try{o.stop(0)}catch(e){}try{o.disconnect(c)}catch(e){}try{c.disconnect(t.destination)}catch(e){}o=null,c=null,t=null,r.audioPlaying=0,n("Context connection failed: "+e)}})).catch((function(e){r.audioPlaying=0,o=null,t=null,console.log("workletNode loading failed: "+e),n("workletNode loading failed: "+e)}))}).catch(e=>{n(e)})}catch(e){alert("Web Audio API is not supported in this browser"),n("Not supported")}})}function f(e,n=null,t=null){return new Promise((o,c)=>{var d,u,_;try{d=new AudioContext,u=null,u=d.createMediaElementSource(e),r.audioPlaying=1,d.audioWorklet.addModule(i).then((function(){(_=new AudioWorkletNode(d,"spectrum-processor")).port.onmessage=e=>{if(Number.isInteger(e.data)?1==e.data&&(r.frames_ack+=e.data,r.frames_ack>r.frames_analyzed&&_&&_.port.postMessage(1)):e.data.bins_Hz?(s.bins_y_labels=e.data.bins_Hz,(r.spec_bands<=0||r.spec_bands!=s.bins_y_labels.length)&&c("Bins Init mismatch: "+String(r.spec_bands)+", "+String(s.bins_y_labels.length))):Uint32Array.prototype.isPrototypeOf(e.data)&&e.data.length>0&&(r.spec_bands<=0||r.spec_bands!=e.data.length?c("Bins count mismatch: "+String(r.spec_bands)+", "+String(e.data.length)):(l.spectrum_push(e.data,r.frames_analyzed),s.plot_enable&&requestAnimFrame(x),r.frames_analyzed++)),2==r.audioPlaying&&r.frames_analyzed>=r.frames_ack||-1==r.audioPlaying){-1==r.audioPlaying?console.log("Demo stream end by disconnect"):console.log("Demo stream end normal (b)"),r.audioPlaying=0,_&&_.port.postMessage(22);try{u.stop(0)}catch(e){}try{u.disconnect(_)}catch(e){}try{u.disconnect(d.destination)}catch(e){}try{_.disconnect(d.destination)}catch(e){}d&&"closed"!=d.state&&d.close(),u=null,_=null,d=null,l.segment_truncate(),s.plot_enable&&requestAnimFrame(x),o("complete_d")}r.last_node_ms=Date.now()},_.port.postMessage(a),_.port.postMessage(0),u.onended=function(){console.log("Demo stream ended"),r.audioPlaying=2,_&&_.port.postMessage(22);try{u.stop(0)}catch(e){}try{u.disconnect(_)}catch(e){}try{u.disconnect(d.destination)}catch(e){}if(u=null,r.frames_analyzed>=r.frames_ack&&0!=r.audioPlaying){console.log("Demo stream end normal"),r.audioPlaying=0;try{_.disconnect(d.destination)}catch(e){}d&&"closed"!=d.state&&d.close(),_=null,d=null,l.segment_truncate(),s.plot_enable&&requestAnimFrame(x),o("complete")}},window.setTimeout((function e(){if(Date.now()-r.last_node_ms<1e3){setTimeout(e,100);try{_.port.postMessage(22)}catch(e){}}else if(2==r.audioPlaying&&_){try{_.port.postMessage(22)}catch(e){}r.audioPlaying=0,r.last_node_ms=0,console.warn("Worklet is stuck. Terminating."),u=null,_=null,d=null,o(2)}else-1==r.audioPlaying&&(u=null,_=null,d=null,o(3))}),100);try{u.connect(d.destination),u.connect(_),_.connect(d.destination),u.loop=!1,r.PlayMode=1,n?t?e.play(0,n,t):e.play(0,n):e.play(0)}catch(e){console.log("Demo stream failed: "+e);try{u.stop(0)}catch(e){}try{u.disconnect(_)}catch(e){}try{u.disconnect(d.destination)}catch(e){}try{_.disconnect(d.destination)}catch(e){}u=null,_=null,d=null,r.audioPlaying=0,c("Demo stream loading failed: "+e)}})).catch((function(e){r.audioPlaying=0,u=null,d=null,console.log("workletNode loading failed: "+e),c("workletNode loading failed: "+e)}))}catch(e){alert("Web Audio API is not supported in this browser"),c("Not supported")}})}function g(e,n=null,t=null){return new Promise((o,c)=>{var d,u,_;try{d=new AudioContext,u=null,u=d.createBufferSource(),r.audioPlaying=1,d.audioWorklet.addModule(i).then((function(){(_=new AudioWorkletNode(d,"spectrum-processor")).port.onmessage=e=>{if(Number.isInteger(e.data)?1==e.data&&(r.frames_ack+=e.data,r.frames_ack>r.frames_analyzed&&_&&_.port.postMessage(1)):e.data.bins_Hz?(s.bins_y_labels=e.data.bins_Hz,(r.spec_bands<=0||r.spec_bands!=s.bins_y_labels.length)&&c("Bins Init mismatch: "+String(r.spec_bands)+", "+String(s.bins_y_labels.length))):Uint32Array.prototype.isPrototypeOf(e.data)&&e.data.length>0&&(r.spec_bands<=0||r.spec_bands!=e.data.length?c("Bins count mismatch: "+String(r.spec_bands)+", "+String(e.data.length)):(l.spectrum_push(e.data,r.frames_analyzed),s.plot_enable&&requestAnimFrame(x),r.frames_analyzed++)),2==r.audioPlaying&&r.frames_analyzed>=r.frames_ack||-1==r.audioPlaying){-1==r.audioPlaying?console.log("Online file end by disconnect"):console.log("Online file end normal (b)"),r.audioPlaying=0,_&&_.port.postMessage(22);try{u.stop(0)}catch(e){}try{u.disconnect(_)}catch(e){}try{u.disconnect(d.destination)}catch(e){}try{_.disconnect(d.destination)}catch(e){}d&&"closed"!=d.state&&d.close(),u=null,_=null,d=null,l.segment_truncate(),s.plot_enable&&(requestAnimFrame(x),setTimeout(x,100)),o("complete_d")}},_.port.postMessage(a),_.port.postMessage(0),u.onended=function(){r.audioPlaying=2,_&&_.port.postMessage(22);try{u.stop(0)}catch(e){}try{u.disconnect(_)}catch(e){}try{u.disconnect(d.destination)}catch(e){}if(u=null,r.frames_analyzed>=r.frames_ack&&0!=r.audioPlaying){console.log("Online file end normal"),r.audioPlaying=0;try{_.disconnect(d.destination)}catch(e){}d&&"closed"!=d.state&&d.close(),_=null,d=null,l.segment_truncate(),s.plot_enable&&requestAnimFrame(x),o("complete")}};try{d.decodeAudioData(e,(function(e){u.buffer=e,u.connect(d.destination),u.connect(_),_.connect(d.destination),u.loop=!1,r.PlayMode=1,n||t?((n-=.5)<0&&(n=0),t?u.start(0,n,t):u.start(0,n)):u.start(0)}),S)}catch(e){console.log("File loading failed: "+e);try{u.stop(0)}catch(e){}try{u.disconnect(_)}catch(e){}try{u.disconnect(d.destination)}catch(e){}try{_.disconnect(d.destination)}catch(e){}u=null,_=null,d=null,r.audioPlaying=0,c("File loading failed: "+e)}})).catch((function(e){r.audioPlaying=0,u=null,d=null,console.log("workletNode loading failed: "+e),c("workletNode loading failed: "+e)}))}catch(e){alert("Web Audio API is not supported in this browser"),c("Not supported")}})}function m(){try{FileAudioContext=null,FileAudioContext=void 0}catch(e){}try{sourceNode=null,sourceNode=void 0}catch(e){}try{workletNode=null,workletNode=void 0}catch(e){}console.log("GC")}function p(e,n=null,t=null){return new Promise((o,c)=>{var d,u,_;try{d=new OfflineAudioContext(1,48e6,48e3),u=null,u=d.createBufferSource(),r.audioPlaying=1,d.audioWorklet.addModule(i).then((function(){(_=new AudioWorkletNode(d,"spectrum-processor")).port.onmessage=e=>{if(Number.isInteger(e.data)?1==e.data&&(r.frames_ack++,r.frames_ack>r.frames_analyzed&&_&&_.port.postMessage(1)):e.data.bins_Hz?(s.bins_y_labels=e.data.bins_Hz,(r.spec_bands<=0||r.spec_bands!=s.bins_y_labels.length)&&c("Bins Init mismatch: "+String(r.spec_bands)+", "+String(s.bins_y_labels.length))):Uint32Array.prototype.isPrototypeOf(e.data)&&e.data.length>0&&(r.spec_bands<=0||r.spec_bands!=e.data.length?c("Bins count mismatch: "+String(r.spec_bands)+", "+String(e.data.length)):(l.spectrum_push(e.data,r.frames_analyzed),s.plot_enable&&requestAnimFrame(x),r.frames_analyzed++)),2==r.audioPlaying&&r.frames_analyzed>=r.frames_ack||-1==r.audioPlaying){r.frames_ack=0,_&&_.port.postMessage(22);try{u.stop(0)}catch(e){}try{u.disconnect(_)}catch(e){}try{_.disconnect(d.destination)}catch(e){}u=null,_=null,d=null,-1==r.audioPlaying?console.log("Offline file end by disconnect"):console.log("Offline file end normal (b)"),r.audioPlaying=0,l.segment_truncate(),s.plot_enable&&requestAnimFrame(x),o("complete_u")}r.last_node_ms=Date.now()},_.port.postMessage(a),_.port.postMessage(0);try{d.decodeAudioData(e,(function(e){u.buffer=e,u.connect(_),_.connect(d.destination),u.loop=!1,r.PlayMode=2,n?t?u.start(0,n,t):u.start(0,n):u.start(0),d.startRendering().then((function(e){console.log("Rendering finished."),window.setTimeout((function e(){if(Date.now()-r.last_node_ms<1e3){setTimeout(e,100);try{_.port.postMessage(22)}catch(e){}}else if(2==r.audioPlaying&&_){try{_.port.postMessage(22)}catch(e){}r.audioPlaying=0,r.last_node_ms=0,console.warn("Worklet is stuck. Terminating."),u=null,_=null,d=null,o(2)}else-1==r.audioPlaying&&(u=null,_=null,d=null,o(3))}),100),(r.frames_analyzed>=r.frames_ack||r.frames_ack)&&window.setTimeout((function(){r.audioPlaying=2,_&&_.port.postMessage(22)}),100),u=null})).catch((function(e){r.audioPlaying=0,console.log("Rendering failed: "+e),c("Rendering failed: "+e)}))}),S)}catch(e){console.log("File loading failed: "+e);try{u.stop(0)}catch(e){}try{_.disconnect(d.destination)}catch(e){}try{u.disconnect(_)}catch(e){}try{_.disconnect(d.destination)}catch(e){}u=null,_=null,d=null,r.audioPlaying=0,c("File loading failed: "+e)}})).catch((function(e){r.audioPlaying=0,u=null,d=null,console.log("workletNode loading failed: "+e),c("workletNode loading failed: "+e)}))}catch(e){alert("Web Audio API is not supported in this browser. Error: "+e),c("Web Audio API error: "+e)}})}function h(e){0!=r.audioPlaying&&(r.audioPlaying=-1,console.log("Disconnect Nodes because: "+e))}function y(){return r.audioPlaying>0}let w=0,b=!1,v=!1;function I(e,n,t){l.set_segments_label(e,n,t),v=!0,setTimeout(x,100)}async function x(){b=!0;let e=l.get_context_maximum();if(1==s.process_level||2==s.process_level){if(w++,w<s.plot_lag)return b=!1,!0;w=0;let n=l.get_spectrum();n.length>0&&(2==s.process_level?(o.clear_plot(!1),o.plot_spectrum(n,e,s.bins_y_labels),o.plot_axis_majors(s.bins_y_labels,s.axis_labels_sep)):(o.clear_plot(!0),o.plotBands(n[n.length-1],e,s.bins_y_labels,s.axis_labels_sep))),n=null}else if(3==s.process_level||s.process_level>=4){let n=0,t=l.get_segments_count(s.process_level);if(s.last_seg_len!=t||v){v=!1,s.last_seg_len=t,o.clear_plot();for(let i=t-1;i>=0;i--){let t=l.get_segments_ci(i)[1];if(t>0){let r=l.get_segment(i,s.process_level),a=l.get_seg_timestamps(i);n=n+t+2;let c=s.plot_len-n;if(s.process_level>=4?(o.plot_formants(r,t,a,c,e),6!=s.process_level&&7!=s.process_level||o.plot_phoneme_anchors(i,l.get_phonemes_ci(i),c)):3==s.process_level&&o.plot_raw_segment(r,t,a,c,e),n>s.plot_len)break;r=null;let d=l.get_segments_label(i);o.plot_segment_labels(t,c,d)}else console.warn("Segment size error, si:"+i+", size:"+t)}o.plot_axis_majors(s.bins_y_labels,s.axis_labels_sep)}}else console.log("Error: Invalid process_level");return b=!1,!0}function S(e){console.log(e),r.audioPlaying=0,document.getElementById("msg").textContent="Error"}window.requestAnimFrame_2=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e,n){window.setTimeout(e,100)},window.requestAnimFrame=function(e){b||(window.setTimeout(e,10),b=!0)}},function(e,n,t){"use strict";t.r(n),t.d(n,"reset_segmentation",(function(){return B})),t.d(n,"spectrum_push",(function(){return P})),t.d(n,"segment_truncate",(function(){return C})),t.d(n,"get_context_maximum",(function(){return F})),t.d(n,"get_spectrum",(function(){return L})),t.d(n,"get_segment",(function(){return O})),t.d(n,"get_phonemes_ci",(function(){return T})),t.d(n,"get_phn_timestamps",(function(){return D})),t.d(n,"get_segments_ci",(function(){return R})),t.d(n,"get_seg_timestamps",(function(){return z})),t.d(n,"get_segments_count",(function(){return H})),t.d(n,"get_segments_label",(function(){return J})),t.d(n,"set_segments_label",(function(){return q}));const l=t(1),o=t(8),i=t(0);var r={spec_bands:-1,plot_len:300,max_voiced_bin:80,window_step:.025,current_frame:0,play_end:!1,no_fm_segs:0,c_ci:0,c_started:-1,current_label:[],callbacks_processed:0,seg_limit_1:200,seg_limit_2:250,seg_min_frames:20,seg_breaker:12,process_level:5,call_at_end:!1};var a=[],s=[],c=[],d=[],u=[],_=[],f=[],g=[],m=[],p=!1,h=50,y=2;let w=h,b=y;var v,I=0,x=0,S=0;let E=!0;function B(e,n,t,o,i,B,N=null,k=!0,M=[]){return a=null,s=null,c=null,_=null,u=null,f=null,g=null,E=k,0==E&&(v=N),new Promise((v,E)=>{n?(r.process_level=e,r.spec_bands=n,r.plot_len=t,r.seg_limit_1=t-10,r.seg_limit_2=t-4,r.max_voiced_bin=parseInt(.7*n),r.window_step=o/1e3,r.seg_breaker=i>2*o?i/o:250/o,r.seg_min_frames=parseInt(B/o),r.current_label=M,r.play_end=!1,r.no_fm_segs=0,r.c_ci=0,r.c_started=-1,a=[],r.current_frame=0,r.callbacks_processed=0,l.clear_fm(),s=[],c=[],u=[],d=[],_=[],f=[],g=[],I=0,x=0,S=0,w=h=100,b=y=10,m=[],p=!1,v("ready")):E("Invalid spec_bands")})}function N(e=-1){r.c_ci=0,r.c_started=e,r.no_fm_segs=0,l.clear_fm()}async function k(){for(p=!0;m.length>0;){let e=m.splice(0,1)[0],n=r.c_ci,t=0,o=1,i=0,a=0,s=0,c=0,d=0,u=[],_=0,f=2*y,g=0,p=0;for(;o<r.spec_bands;){if(p+=e[o],e[o]>e[o-1]&&(o<2||e[o]>e[o-2])&&(o<3||e[o]>e[o-3])){if(-1==d||0==d){if(-1==d&&e[a]>y&&i<=a&&a<s){e[a]>f&&(f=e[a],g=a);let n=e[a]/10;for(;i<a&&e[i]<n;)i++;for(;s>a&&e[s]<n;)s--;u[t]=[i,s,a],t++,_+=e[a]}i=o-1,a=o}else 1==d&&(a=o);d=1}else if(e[o]<e[o-1]&&(o<2||e[o]<e[o-2])&&(o<3||e[o]<e[o-3]))1!=d&&-1!=d||(s=o,d=-1);else if(-1==d){if(c++,c>2){if(c=0,e[a]>y&&i<=a&&a<s){e[a]>f&&(f=e[a],g=a);let n=e[a]/10;for(;i<a&&e[i]<n;)i++;for(;s>a&&e[s]<n;)s--;u[t]=[i,s,a],t++,_+=e[a]}d=0}}else 1==d&&e[o]>e[o-1]&&(a=o);if(o==r.spec_bands-1&&1==d&&(s=o,a=o,e[a]>y&&i<a&&a<=s)){let n=e[a]/10;for(;i<a&&e[i]<n;)i++;for(;s>a&&e[s]<n;)s--;u[t]=[i,s,a],t++,_+=e[a]}o++}if(r.c_started<0){let e=_>f?f*(t-1)/(_-f):0;t>0&&g>7&&g<r.max_voiced_bin&&t>4&&e>4?(N(0),r.c_started=0):r.no_fm_segs++}r.c_started>=0&&(0==t||g<7||g>=r.max_voiced_bin||t>3&&_/(p-_)<.1?(r.no_fm_segs++,r.c_started<2?r.c_started--:r.no_fm_segs>=r.seg_breaker?M(r.c_ci+1).then((function(){N(-1),0==r.call_at_end&&$()})).catch(e=>{N(-1)}):A(f)):(A(f),l.accumulate_fm(e,u,n,p,y),r.c_started<2?r.c_started++:r.no_fm_segs=0)),r.c_ci++,u=null}r.play_end&&M(r.c_ci).then((function(){N(1),r.play_end&&$()})).catch(e=>{N(1)}),p=!1}function M(e){return new Promise((n,t)=>{let i=e-r.no_fm_segs;if(i>r.seg_min_frames&&r.c_started>=2){let e=r.current_frame-i,a=l.get_ranked_formants();if(7==r.process_level){let t=l.straighten_formants(a,i,y),m=o.sep_phonemes(t[0],t[1],i),p=o.phonemes_features(m[1]);u.push(r.current_label.slice()),d.push([e,i]),s.push(a),c.push(t[0]),_.push(null),m[1]=null,f.push(m),g.push(p),n(1)}else if(6==r.process_level){let t=l.straighten_formants(a,i,y),g=o.sep_phonemes(t[0],t[1],i);u.push(r.current_label.slice()),d.push([e,i]),s.push(a),c.push(t[0]),_.push(null),f.push(g),n(1)}else if(5==r.process_level){let t=l.straighten_formants(a,i,y),o=l.formant_features(t[0]);u.push(r.current_label.slice()),d.push([e,i]),s.push(a),c.push(t[0]),_.push(o),n(1)}else if(4==r.process_level){let t=l.straighten_formants(a,i,y);u.push(r.current_label.slice()),d.push([e,i]),s.push(a),c.push(t[0]),n(1)}else 3==r.process_level?(u.push(r.current_label.slice()),d.push([e,i]),s.push(a),n(1)):(console.error("Invalid process_level"),t(0))}else i>1?(console.log(d.length+": seg_size:"+i+", ignored, too small < "+r.seg_min_frames),n(0)):n(0)})}function A(e){if(I++,e>h||I>40&&e>2*y){e>=h?(I=0,w=h=e):e>w/100&&(h-=parseInt(h/8),I=35);let n=Math.log10(h);y=n>7?parseInt(Math.pow(10,n-3)/20):n>6?parseInt(Math.pow(10,n-3)/2):n>4?parseInt(Math.pow(10,n-2)/2):n>2?parseInt(Math.pow(10,n/3)):n>1?parseInt(h/10):1,b=y,S>0&&x/S<30*y&&(N(0),S=0,x=0),x+=h,S+=1}else y>10&&y>b/10&&I>20&&(y-=parseInt(b/20))<10&&(y=10)}function $(){if(E)return!0;if(r.spec_bands>0){if(7==r.process_level)for(;r.callbacks_processed<g.length;){r.callbacks_processed++;let e=r.callbacks_processed-1;g[e].length>0&&(v?v(e,r.current_label,D(e),g[e]):console.warn("callback_func is not set"))}else if(6==r.process_level)for(;r.callbacks_processed<f.length;){r.callbacks_processed++;let e=r.callbacks_processed-1;f[e][1].length>0&&(v?v(e,r.current_label,D(e),f[e][1]):console.warn("callback_func is not set"))}else if(5==r.process_level)for(;r.callbacks_processed<_.length;){r.callbacks_processed++;let e=r.callbacks_processed-1;_[e].length>0&&(v?v(e,r.current_label,z(e),_[e]):console.warn("callback_func is not set"))}else if(4==r.process_level)for(;r.callbacks_processed<c.length;){r.callbacks_processed++;let e=r.callbacks_processed-1;c[e].length>0&&(v?v(e,r.current_label,z(e),c[e]):console.warn("callback_func is not set"))}else if(3==r.process_level)for(;r.callbacks_processed<s.length;){r.callbacks_processed++;let e=r.callbacks_processed-1;s[e].length>0&&(v?v(e,r.current_label,s[e]):console.log("callback_func is not set"))}}else console.warn("s_set.spec_bands is not set yet.");return!0}function P(e,n){if(r.spec_bands==e.length){r.c_ci,r.no_fm_segs;if(r.current_frame++,r.process_level<=2){a.push(e),r.process_level<=1?a.splice(0,a.length-1):a.length>r.plot_len&&a.splice(0,1);let n=i.arrayMax(e);n>h?(h=n,I=0,w=n):I>r.seg_limit_1&&h>w/4?h*=.99:I++}else m.push(e),0==p&&k()}else console.error("Error: bins num mismatch "+r.spec_bands+", "+e.length)}function C(){window.setTimeout((function(){r.play_end=!0,0==p&&k()}),10)}function F(){return h/7}function L(){return a}function O(e,n){return n>=4&&r.process_level>=4?c[e]:r.process_level>=3?s[e]:[]}function T(e){return f[e][0]}function D(e){const n=f[e][0].length;let t=[];try{for(let l=0;l<n;l++)t[l]=[],t[l][0]=((d[e][0]+f[e][0][l][0])*r.window_step).toFixed(3),t[l][1]=((f[e][0][l][1]+1)*r.window_step).toFixed(3)}catch(e){console.error(e)}return t}function R(e){return d[e]}function z(e){return[d[e][0]*r.window_step,(d[e][1]+1)*r.window_step]}function H(e){return e>=6&&r.process_level>=6||e>=4&&r.process_level>=4?c.length:3==r.process_level?s.length:0}function J(e){return u[e]}function q(e,n,t){for(;u[e].length<n;)u[e][u[e].length]=-1;u[e][n]=t}},function(e,n,t){"use strict";t.r(n),t.d(n,"phonemes_features",(function(){return o})),t.d(n,"sep_phonemes",(function(){return i})),t.d(n,"probs_calc_feb16",(function(){return r})),t.d(n,"straighten_formants_feb16",(function(){return a})),t.d(n,"analyze_formant_feb16",(function(){return s}));t(0);const l=t(1);function o(e){try{let n=[];for(let t=0;t<e.length;t++)n.push(l.formant_features(e[t]));return n}catch(e){return console.error(e),null}}function i(e,n,t){let l=[],o=[],i=0,r=0;let a=0,s=0;try{for(let c=0;c<t;c++){const d=n[c][1];if(0==r?c<t-1&&d>10&&n[c+1][1]>10&&(r=1,i=c,a=d,s=a):1==r&&(d>a?a=d:(d<a/2&&(c>=t-1||n[c+1][1]<a/2)||c>=t-1)&&(r=2,d<s&&(s=d))),2==r)if(c>=t-1||d<100&&(c<t-1||n[c+1][1]<200)||c<t-1&&n[c+1][1]>s){r=0,s=d;const n=i,t=c-i;l.push([n,t]),o.push(e.slice(n,c))}else d<s&&(s=d)}}catch(e){console.error(e)}return[l,o]}function r(e,n){let t=new Array(192).fill(0),l=0;for(let o=0;o<n;o++)for(let n=0;n<3;n++){let i=e[o][3*n];i>0&&(i=parseInt(i/2),t[64*n+i]+=e[o][3*n+1],t[64*n+i]>l&&(l=t[64*n+i]))}if(l>0)for(let e=0;e<192;e++)t[e]=t[e]/l;return t}function a(e,n,t){let l=0,o=0,i=0,r=new Array(n).fill(0),a=new Array(n).fill(0),s=new Array(n).fill(0),c=new Array(n).fill(0),d=[],u=[],_=[],f=0;for(;l<e.length;){let g=0,m=0;for(let t=0;t<e[l][14];t++){let o=e[l][7][t];if(o<=n){let i=e[l][10][t];for(let e=0;e<n;e++)if(s[e]>0&&r[e]>0){let t=Math.abs(n-Math.abs(e-o))/n;g+=t,m+=Math.abs(i-r[e]/s[e])*t}}}if(g>0&&m/g<10)e[l][16]=i-1;else{if(i<=2&&f<10*t&&l>0)for(let n=o;n<l;n++)e[n][16]=-1;else i>0&&(d[i-1]=r,u[i-1]=a,_[i-1]=s),i++;r=new Array(n).fill(0),a=new Array(n).fill(0),s=new Array(n).fill(0),f=0,e[l][16]=i-1,o=l}for(let t=0;t<e[l][14];t++){let o=e[l][7][t];if(o<=n){let n=e[l][10][t],i=e[l][12][t],d=e[l][9][t]-e[l][8][t]+1;r[o]+=n*i,a[o]+=d*i,s[o]+=i,c[o]+=i,f+=i}}l++}d.length<i&&(d[i-1]=r,u[i-1]=a,_[i-1]=s);for(let e=0;e<n;e++)for(let n=0;n<i;n++)d[n][e]=_[n][e]>0?d[n][e]/_[n][e]:0,u[n][e]=_[n][e]>0?u[n][e]/_[n][e]:0;return[d,u,_]}function s(e,n,t,l){return new Promise((o,i)=>{let r=0,a=0,s=0,c=new Array(n).fill(0),d=new Array(n).fill(0),u=new Array(n).fill(0),_=new Array(n).fill(0),f=new Array(n).fill(0),g=[],m=[],p=0;for(;r<e.length;)if(e[r][14]<l||e[r][13]/e[r][14]<t)e.splice(r,1);else{let l=0,o=0;for(let t=0;t<e[r][14];t++){let i=e[r][7][t];if(i<=n){let a=e[r][10][t];for(let e=0;e<n;e++)if(d[e]>0&&c[e]>0){let t=Math.abs(n-Math.abs(e-i))/n;l+=t,o+=Math.abs(a-c[e]/d[e])*t}}}if(l>0&&o/l<6)e[r][16]=s-1;else{if(s<=2&&p<10*t&&r>0)for(let n=a;n<r;n++)e[n][16]=-1;else s>0&&(g[s-1]=c,m[s-1]=d),s++;c=new Array(n).fill(0),d=new Array(n).fill(0),p=0,e[r][16]=s-1,a=r}for(let t=0;t<e[r][14];t++){let l=e[r][7][t];if(l<=n){let n=e[r][10][t],o=e[r][12][t],i=e[r][9][t]-e[r][8][t]+1;c[l]+=n*o,d[l]+=o,u[l]+=n*o,_[l]+=o,f[l]+=i*o,p+=o}}r++}g.length<s&&(g[s-1]=c,m[s-1]=d);let h=0;for(;h<n-1&&!(_[h]>t&&_[h+1]>t/100);)h++;let y=h;for(h=n;h>y+1&&!(_[h-1]>t&&_[h-2]>t/100);)h--;let w=h,b=w-y;_=_.slice(y,w),u=u.slice(y,w),f=f.slice(y,w),s>0&&b>s_set.seg_min_frames&&t>1?s_set.process_level>=4?(formants_ft.push([]),formants_by_formant(formants_ft.length-1,g,m,s,b,y,w,fm_max_enr,_,u,f).then((function(){fm_segments.push(e),o(1)})).catch(e=>{i(e)})):(fm_segments.push(e),o(1)):i("Segment too small or too quite "+s+", "+b+", "+t)})}},function(e,n,t){"use strict";t.r(n),t.d(n,"init_canvas",(function(){return u})),t.d(n,"clear_plot",(function(){return _})),t.d(n,"plot_raw_segment",(function(){return f})),t.d(n,"plot_axis_majors",(function(){return g})),t.d(n,"plot_phoneme_anchors",(function(){return m})),t.d(n,"plot_formants",(function(){return p})),t.d(n,"plot_segment_labels",(function(){return h})),t.d(n,"plot_spectrum",(function(){return y})),t.d(n,"plotBands",(function(){return b}));let l=null,o=800,i=400,r=256,a=64,s=o/r,c=i/a,d=0;function u(e,n=800,t=400,u=256,_=64){return!!e&&(o=n,i=t,r=u,a=_,s=(o-35)/u,c=i/_,l=e,l.fillStyle="rgb(10, 10, 20)",l.fillRect(0,0,o,i),l.font="30px Trebuchet MS",l.fillStyle="gray",l.textAlign="center",l.fillText("^_^",o/2-15,100),d=0,!0)}function _(e=!0){return!!l&&(d++,e&&l.clearRect(0,0,o,i),!0)}async function f(e,n,t,o,r){if(!l)return!1;let u=d;for(let n=0;n<e.length;n++){if(u!=d)return!0;for(let t=0;t<e[n][14];t++){let i=e[n][7][t],d=e[n][8][t],u=e[n][9][t],_=e[n][10][t],f=510*e[n][11][t]/r,g=40*e[n][12][t]/r,m=(o+i)*s;l.fillStyle="rgb("+g+","+g/2+","+g/4+")";for(let e=d;e<_;e++)l.fillRect(m,(a-e-1)*c,s,c);for(let e=_+1;e<=u;e++)l.fillRect(m,(a-e-1)*c,s,c);l.fillStyle="rgb("+f/6+","+f/1.5+","+f+")",l.fillRect(m,(a-_-1)*c,s,c)}}if(u!=d)return!0;let _=(o+n)*s;return l.font="10px verdana",l.textAlign="left",l.fillStyle="#00ff00",l.fillText(t[0].toFixed(2),(1+o)*s,20),l.fillRect(o*s,0,2,i),l.textAlign="right",l.fillStyle="#ff0000",l.fillText((t[0]+t[1]).toFixed(2),_-s,40),l.fillRect(_,0,2,i),!0}async function g(e,n){if(!l)return!1;l.font="10px verdana",l.textAlign="left",l.fillStyle="#ffffff",l.fillText("Hz",o-45,15);for(let t=0;t<a;t++)t%n==0&&l.fillText(e[t],o-30,(a-t-1)*c+5);return!0}async function m(e,n,t){if(!l)return!1;l.font="10px verdana",l.textAlign="left",l.fillStyle="#ffffff";for(let o=0;o<n.length;o++){let r=n[o][0],a=n[o][1]+1;l.fillText(e+","+o,s*(t+r),i-6),l.fillRect(s*(t+r),i-3,s*a,3)}return!0}async function p(e,n,t,o,r){if(!l)return!1;let u=d;const _=parseInt(e[0].length/3);for(let t=0;t<n;t++){if(u!=d)return!0;for(let n=0;n<_;n++){let i=e[t][3*n];if(i>0){let d=20*e[t][3*n+1]/r,u=parseInt(e[t][3*n+2]/2),_=(o+t)*s;l.fillStyle="rgb("+d+","+d/2+","+d/4+")";for(let e=i-u;e<i;e++)l.fillRect(_,(a-e-1)*c,s,c);for(let e=i+1;e<=i+u;e++)l.fillRect(_,(a-e-1)*c,s,c);l.fillStyle=0==n?"rgb(0, 255, 50)":1==n?"rgb(255, 1, 255)":2==n?"rgb(10, 150, 255)":3==n?"rgb(248, 81, 67)":4==n?"rgb(177, 28, 67)":"rgb(92, 14, 249)",l.fillRect(_,(a-i-1)*c,s,c)}}}if(u!=d)return!0;let f=(o+n)*s;return l.font="10px verdana",l.textAlign="left",l.fillStyle="#ffffff",l.fillText(t[0].toFixed(2),(1+o)*s,20),l.fillRect(o*s,0,2,i),l.textAlign="right",l.fillStyle="#ff3d3d",l.fillText((t[0]+t[1]).toFixed(2),f-s,40),l.fillRect(f,0,2,i),!0}async function h(e,n,t){if(t&&t[1]&&t[1][0]){let o=(n+e)*s,r=t[1][1]*i;l.font="16px verdana",l.fillStyle="#1fff1f",l.textAlign="right",l.fillText(t[1][0],o-s,100),l.fillRect(o,i-r,2,r)}}async function y(e,n){if(!l)return!1;let t=d;for(let l=e.length-1;l>=0;l--)if(window.setTimeout((function(){w(l,e[l],n)}),e.length-l),t!=d)return!0;return!0}function w(e,n,t){l.clearRect(e*s,0,s,i);for(let o=0;o<a;o++){let i=n[o]/t,r=i,d=i,u=i;i>.01&&(i<.1?(r=2550*i,d=100*i,u=0):i<.2?(r=2550*i,d=1e3*i,u=100*i):i<.5?(r=2550*i,d=1250*i,u=500*i):(r=50*i,d=255*i,u=255),l.fillStyle="rgb("+r+","+d+","+u+")",l.fillRect(e*s,(a-o-1)*c,s,c))}}async function b(e,n,t,r){if(!l)return!1;let s,c=d,u=o/a;for(var _=0,f=0;f<a;f++){if(c!=d)return!0;let t=255*(e[f]/n),o=50,r=50;s=i*e[f]/(10*n),l.fillStyle="rgb("+t+","+o+","+r+")",l.fillRect(_,i-s,u,s),_+=u}if(t.length>0){_=0,l.font="10px verdana",l.fillStyle="white",l.textAlign="right",l.fillText("Hz",o/2,40);let e=1;for(let n=0;n<a;n++)n%r==0&&(l.fillText(t[n],_,10+e%3*10),e++),_+=u}return!0}},function(e,n,t){"use strict";t.r(n),t.d(n,"load_all_nn",(function(){return s})),t.d(n,"load_single_nn",(function(){return c})),t.d(n,"train_nn",(function(){return d})),t.d(n,"predict_db_nn",(function(){return u})),t.d(n,"predict_seg_nn",(function(){return f})),t.d(n,"download_nn_model",(function(){return g})),t.d(n,"make_ML_div",(function(){return m}));const l=t(2);console.log("ml5 version:",ml5.version);var o=null,i=null;const r="cats",a="ords";async function s(e=null){return new Promise((n,t)=>{if(l.get_label_heads()&&nn_models&&Object.keys(nn_models).length>=label_cats.length)console.log("Models already loaded"),n(1);else if(document.getElementById("nn_msg").textContent="Loading default models...",recheck_label_cats(),label_cats&&label_cats.length>0){let l=[];for(let e=0;e<label_cats.length;e++)l[e]=c(label_cats[e],!0);Promise.all(l).then((function(){document.getElementById("nn_msg").textContent="Default models loaded: "+String(Object.keys(nn_models).length),console.log("All NN models loaded"),n(1),e&&e()})).catch(e=>{document.getElementById("nn_msg").textContent="ERROR: models loading failed: "+String(Object.keys(nn_models).length),console.error(e),t(e)})}else t("Labels not loaded yet")})}function c(e,n,t=!1,l=null,s=null){return new Promise((c,d)=>{if(0==t&&(e==r&&o&&o[n]&&o[n].ready||e==a&&i&&i[n]&&i[n].ready))console.log("Model ready\t"+n),c(1);else{if(console.log("Loading model\t"+e+"\t"+n),0==(e==r||e==a))return void d("Invalid label type "+e);let t=!1,_=ml5.neuralNetwork();function u(){console.log("Model load success"),e==r?(null==o&&(o={}),o[n]=_):e==a&&(null==i&&(i={}),i[n]=_),t=!0,c(1),l?(m(!0),document.getElementById("nn_msg").textContent="Model loaded from files for "+n,document.getElementById("pred_"+e+"_"+n).disabled=!1):(m(!0),document.getElementById("nn_msg").textContent="Model loaded from web for "+n,document.getElementById("pred_"+e+"_"+n).disabled=!1)}console.log("Loading model for "+n),l?3!=l.length?(alert("Please load the 3 files of model, model_meta and weights bin"),d(0)):_.load(l,u):s?_.load(s,u):d("No model available to load"),setTimeout((function(){_=null,t||d("Error while loading model for "+String(n))}),2e3)}})}function d(e,n,t){let s=JSON.parse(document.getElementById("text_NN_options_"+n+"_"+t).value);if(0==p(s))return void alert("Invalid syntax");document.getElementById("nn_train_modal_"+n+"_"+t).style.display="none";let c=parseInt(document.getElementById("epochs_"+n+"_"+t).value);c<1&&(c=10);let d=parseInt(document.getElementById("batch_"+n+"_"+t).value);d<1&&(d=10),document.getElementById("nn_msg").textContent="Processing data for training for label "+t;let u=l.collect_db_data(e);if(u){const e=!0;console.log("Training "+n+"\t"+t),console.log(s);const f={epochs:c,batchSize:d};console.log(f);let g=ml5.neuralNetwork(s),m=u[0].length,h=0,y=l.get_label_heads();if(n==r&&y[0]){let n=y[0],l=null,o=[];for(let e=0;e<n.length;e++)if(Object.keys(n[e])[0]==t){l=t,o=n[e][l];break}console.log(l+"\t"+o);let i=new Array(o.length).fill(0);function _(e,n=null){if(u[4][e]&&p(u[4][e][0])&&null!=u[4][e][0][l]){const r=o.indexOf(u[4][e][0][l]),a=o.indexOf("*");if((r>=0||a>=0)&&(null==n||r==n)){let l=u[4][e][0][t];const o={y:String(l)},a=u[2][e];g.addData(a,o),null==n&&h++,r>=0&&i[r]++}}}for(let e=0;e<m;e++)_(e);if(console.log("Samples: "+String(i)),h<10)return void(document.getElementById("nn_msg").textContent="Sample size "+String(h)+"/"+String(m)+" too small for training");if(e){const e=function(e){let n=e.length,t=-1/0;for(;n--;)e[n]>t&&(t=e[n]);return t}(i);if(e>0)for(let n=0;n<o.length;n++)for(;i[n]<e&&i[n]>10;)for(let t=0;t<m&&(i[n]<e&&_(t,n),!(i[n]>=e));t++);}console.log("Balanced: "+String(i))}else{if(n!=a||!y[1])return void console.error("Invalid label type");{let e=y[1],n=null;for(let l=0;l<e.length;l++)if(e[l]==t){n=t;break}function _(e,t=!0){if(u[4][e]&&p(u[4][e][1])&&null!=u[4][e][1][n]&&(t||0!=u[4][e][1][n])){const t={y:u[4][e][1][n]},l=u[2][e];g.addData(l,t),h++}}for(let e=0;e<m;e++)_(e);if(console.log("Samples: "+String(h)),h<10)return void(document.getElementById("nn_msg").textContent="Sample size "+String(h)+"/"+String(m)+" too small for training")}}document.getElementById("nn_msg").innerHTML=`Using ${h}/${m} samples to train the model<br>`,document.getElementById("nn_msg").innerHTML+=`<div class="w3-animate-fading"><b>Starting training for ${t}...</b></div>`,g.normalizeData();try{g.train(f,(function(e,n){document.getElementById("nn_msg").textContent="Epoch: "+e+", loss: "+n.loss.toFixed(3)+", accuracy: "+n.acc.toFixed(3)}),(function(){n==r?(o||(o={}),o[t]=null,o[t]=g,document.getElementById("nn_msg").textContent="Finished training. New model is loaded for label: "+t,document.getElementById("pred_"+n+"_"+t).disabled=!1):n==a&&(i||(i={}),i[t]=null,i[t]=g,document.getElementById("nn_msg").textContent="Finished training. New model is loaded for label: "+t,document.getElementById("pred_"+n+"_"+t).disabled=!1)}))}catch(e){console.error(e),document.getElementById("nn_msg").innerText=e,g=null}u=null}else document.getElementById("nn_msg").textContent="No data for training"}async function u(e,n,t){let s=l.collect_db_data(e);console.log("predict_db_nn\t"+n+"\t"+t),c(n,t,!1).then((function(){if(n==r&&o[t].ready||n==a&&i[t].ready)if(s){n==r?console.log(o[t].options):n==a&&console.log(i[t].options),document.getElementById("nn_msg").textContent="Predicting label "+t;for(let e=0;e<s[0].length;e++){const l=s[2][e],c=function(l,o){_(l,o,n,t,s[0][e])};n==r?o[t].classify(l,c):n==a&&i[t].predict(l,c)}window.setTimeout((function(){document.getElementById("nn_msg").textContent="Finished prediction of "+String(t),l.shows_stats_table(null,e)}),500)}else document.getElementById("nn_msg").textContent="No data for prediction";else document.getElementById("nn_msg").textContent="ML model not loaded or trained yet"})).catch(e=>{console.error(e),document.getElementById("nn_msg").textContent=e})}function _(e,n,t,o,i){if(e&&(console.error(e),document.getElementById("nn_msg").innerHTML+="ERROR: "+String(i)+", "+e+". <br>"),n)if(t==r){let e=0,t=null;for(let l=0;l<n.length;l++)n[l].confidence>e&&(e=n[l].confidence,t=n[l].label);l.update_pred_label(i,o,t)}else t==a&&l.update_pred_label(i,o,n[0].value)}function f(e,n){if(nn_loaded>0&&nn_model.ready)if(e){const t=function(e){let n="{";for(let t=0;t<40;t++)n+='"x'+String(t)+'": '+String(e[t]),t<39&&(n+=", ");return n+="}",n=JSON.parse(n),n}(e),l=function(e,t){!function(e,n,t){e&&(console.error(e),document.getElementById("nn_msg").innerHTML+="  ERROR: "+e+". <br>");n&&t&&t(n)}(e,t,n)};nn_model.classify(t,l)}else document.getElementById("nn_msg").textContent="No data received for prediction";else document.getElementById("nn_msg").textContent="ML model not loaded or trained yet"}function g(e,n){function t(){document.getElementById("nn_msg").textContent="Model download started for "+n}e==r&&o&&o[n]?o[n].save("model",t):e==a&&i&&i[n]?i[n].save("model",t):document.getElementById("nn_msg").textContent="ML model is not loaded or trained yet for "+n}function m(e){if(e){let e=l.get_label_heads();if(e&&e.length>=2){let n=e[0],t=e[1];document.getElementById("ML_training_div").innerHTML='<h3 class="w3-opacity">ML Training</h3>';let l="",s="";for(let e=0;e<n.length;e++){const t=r;if(p(n[e])){const i=Object.keys(n[e])[0];l+=`<div class="w3-cell w3-border w3-border-lime" style="width:100px; margin-left:10px; display: inline-block;">\n                        <h5>${i}</h5>\n                        <div class="w3-row w3-margin-top">\n                        <button onclick="document.getElementById('nn_train_modal_${t}_${i}').style.display='block'" class="w3-button w3-tiny w3-border w3-border-indigo">Model</button>\n                        </div>\n                        <div class="w3-row w3-margin-top">\n                            <button onclick="FASER.start_nn_prediction('${t}', '${i}')" class="w3-button w3-tiny w3-border w3-border-indigo w3-margin-bottom"  id="pred_${t}_${i}" disabled>Predict</button>\n                        </div>\n                    </div>`,s+=`<div id="nn_train_modal_${t}_${i}" class="w3-modal w3-animate-opacity">\n                        <div class="w3-modal-content w3-card-4 w3-animate-zoom">\n\n                        <header class="w3-container w3-theme-d1"> \n                        <span onclick="document.getElementById('nn_train_modal_${t}_${i}').style.display='none'" \n                        class="w3-button w3-red w3-xlarge w3-display-topright">&times;</span>\n                        <h2>Classification NN for ${i}</h2>\n                        </header>\n\n                        <div class="w3-container w3-theme-d2 w3-small w3-left-align">\n                            <div class="w3-row w3-padding-small ">\n                                \n                                <p>Download the trained model or load a pre-trained model</p>\n                                    \n                                <div class="w3-col m2">\n                                    <button onclick="FASER.download_nn_model('${t}','${i}')" class="w3-button w3-tiny w3-border w3-indigo">Download Model</button>\n                                </div>\n\n                                <div class="w3-col m2">\n                                <input type="file" id="nn_mod${t}_${i}" name="nn_${t}_${i}[]" onchange="FASER.load_files_nn_model(this.files, '${t}', '${i}')" multiple="" class="w3-button w3-hover-border-khaki w3-padding"/>\n\n                                </div>\n                            </div>\n                            <h6>Model training options</h6>\n                            <a href="https://learn.ml5js.org/#/reference/neural-network?id=defining-custom-layers"> References </a> \n                            \n                            <div class="w3-row w3-left-align">\n                                <textarea name="text_NN_options_${t}_${i}" id="text_NN_options_${t}_${i}" cols="10" rows="25" class="w3-input w3-dark-input" style="font-family: 'Courier New', Courier, monospace; max-height:300px;">${null!==o&&o[i]?JSON.stringify(o[i].options):h}</textarea>\n                            </div>\n                        </div>\n                        \n\n                        <div class="w3-row-padding w3-theme-d2 w3-left-align w3-small">\n                            <div class="w3-third">\n                                <label for="epochs">Epochs</label>\n                                <input class="w3-input w3-dark-input w3-margin-right" type="number" id="epochs_${t}_${i}" placeholder="10" value="10">\n                            </div>\n                            <div class="w3-third">\n                                <label for="batch">Batch size</label>\n                                <input class="w3-input w3-dark-input" type="number" id="batch_${t}_${i}" placeholder="10" value="10">\n                            </div>\n                        </div> \n\n                        <div class="w3-container  w3-theme-d1 w3-padding">\n\n                        <button class="w3-button w3-left w3-blue-grey w3-border w3-round-large w3-margin-left" onclick="document.getElementById('nn_train_modal_${t}_${i}').style.display='none'">Close</button>\n\n                            <button class="w3-button w3-left w3-teal w3-border w3-round-large w3-margin-right"\n                            onclick="FASER.start_nn_training('${t}', '${i}')">Start Training</button>\n\n                        </div>\n                    </div>\n                </div>`}}for(let e=0;e<t.length;e++){const n=a;if(null!=t[e]){const o=t[e];l+=`<div class="w3-cell w3-border w3-border-blue" style="width:100px; margin-left:10px; display: inline-block;">\n                        <h5>${o}</h5>\n                        <div class="w3-row w3-margin-top">\n                        <button onclick="document.getElementById('nn_train_modal_${n}_${o}').style.display='block'" class="w3-button w3-tiny w3-border w3-border-indigo">Model</button>\n                        </div>\n                        <div class="w3-row w3-margin-top">\n                            <button onclick="FASER.start_nn_prediction('${n}', '${o}')" class="w3-button w3-tiny w3-border w3-border-indigo w3-margin-bottom" id="pred_${n}_${o}" disabled>Predict</button>\n                        </div>\n                    </div>`,s+=`<div id="nn_train_modal_${n}_${o}" class="w3-modal w3-animate-opacity">\n                    <div class="w3-modal-content w3-card-4 w3-animate-zoom">\n\n                        <header class="w3-container w3-theme-d1"> \n                        <span onclick="document.getElementById('nn_train_modal_${n}_${o}').style.display='none'" \n                        class="w3-button w3-red w3-xlarge w3-display-topright">&times;</span>\n                        <h2>Regression NN for ${o}</h2>\n                        </header>\n\n                        <div class="w3-container w3-theme-d2 w3-small w3-left-align">\n                            <div class="w3-row w3-padding-small ">\n                                \n                                <p>Download the trained model or load a pre-trained model</p>\n                                    \n                                <div class="w3-col m2">\n                                    <button onclick="FASER.download_nn_model('${n}','${o}')" class="w3-button w3-tiny w3-border w3-indigo">Download Model</button>\n                                </div>\n\n                                <div class="w3-col m2">\n                                <input type="file" id="nn_mod${n}_${o}" name="nn_${n}_${o}[]" onchange="FASER.load_files_nn_model(this.files, '${n}', '${o}')" multiple="" class="w3-button w3-hover-border-khaki w3-padding"/>\n\n                                </div>\n                            </div>\n                            <h6>Model training options</h6>\n                            <div class="w3-row w3-left-align">\n                                <textarea name="text_NN_options_${n}_${o}" id="text_NN_options_${n}_${o}" cols="10" rows="25" class="w3-input w3-dark-input" style="font-family: 'Courier New', Courier, monospace; max-height:300px;">${null!==i&&i[o]?JSON.stringify(i[o].options):y}</textarea>\n                            </div>\n                        </div>\n                        \n\n                        <div class="w3-row-padding w3-theme-d2 w3-left-align w3-small">\n                            <div class="w3-third">\n                                <label for="epochs">Epochs</label>\n                                <input class="w3-input w3-dark-input w3-margin-right" type="number" id="epochs_${n}_${o}" placeholder="10" value="10">\n                            </div>\n                            <div class="w3-third">\n                                <label for="batch">Batch size</label>\n                                <input class="w3-input w3-dark-input" type="number" id="batch_${n}_${o}" placeholder="10" value="10">\n                            </div>\n                        </div> \n\n                        <div class="w3-container  w3-theme-d1 w3-padding">\n\n                        <button class="w3-button w3-left w3-blue-grey w3-border w3-round-large w3-margin-left" onclick="document.getElementById('nn_train_modal_${n}_${o}').style.display='none'">Close</button>\n\n                            <button class="w3-button w3-left w3-teal w3-border w3-round-large w3-margin-right"\n                            onclick="FASER.start_nn_training('${n}', '${o}')">Start Training</button>\n\n                        </div>\n                    </div>\n                </div>`}}document.getElementById("ML_training_div").innerHTML+=l,document.getElementById("ML_training_div_modals").innerHTML=s,l=null,s=null}}else document.getElementById("ML_training_div").innerHTML=""}function p(e){return e&&"object"==typeof e&&e.constructor===Object}const h='{\n    "task": "classification",\n    "inputs": 40,\n    "outputs": 1,\n    "learningRate": 0.2,\n    "debug": true,\n    "layers":\n    [\n        {\n            "type": "dense",\n            "units": 128,\n            "kernel_regularizer": "l2",\n            "activation": "relu"\n        },\n        {\n            "type": "dense",\n            "units": 64,\n            "activation": "relu"\n        },\n        {\n            "type": "dense",\n            "units": 16,\n            "activation": "relu"\n        },\n        {\n            "type": "dense",\n            "activation": "softmax"\n        }\n    ]\n}',y='{\n    "task": "regression",\n    "inputs": 40,\n    "outputs": 1,\n    "learningRate": 0.2,\n    "debug": true,\n    "layers":\n    [\n        {\n            "type": "dense",\n            "units": 64,\n            "activation": "sigmoid"\n        },\n        {\n            "type": "dense",\n            "units": 16,\n            "activation": "sigmoid"\n        },\n        {\n            "type": "dense",\n            "activation": "sigmoid"\n        }\n    ]\n}'}]);